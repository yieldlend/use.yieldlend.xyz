"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1811],{34637:function(e,t,r){r.d(t,{Y:function(){return p},Z:function(){return m}});var n=r(59499),a=r(77191),o=r(81719),s=r(87054),i=(r(67294),r(85893));function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var c=(0,o.ZP)(s.Z)((function(e){return(0,a.Z)(e),{border:"0px",flex:1,backgroundColor:"#535047",borderRadius:"4px","&.Mui-selected, &.Mui-selected:hover":{backgroundColor:"#FFFFFF",borderRadius:"4px !important"},"&.Mui-selected, &.Mui-disabled":{zIndex:100,height:"100%",display:"flex",justifyContent:"center",color:"#70562e",".MuiTypography-subheader1":{},".MuiTypography-secondary14":{}}}})),d=(0,o.ZP)(s.Z)((function(e){var t=e.theme;return{border:"0px",flex:1,color:t.palette.text.muted,borderRadius:"4px","&.Mui-selected, &.Mui-selected:hover":{border:"1px solid ".concat(t.palette.other.standardInputLine),backgroundColor:"#FFFFFF",borderRadius:"4px !important"},"&.Mui-selected, &.Mui-disabled":{zIndex:100,height:"100%",display:"flex",justifyContent:"center",color:t.palette.background.header}}}));function p(e){return(0,i.jsx)(d,l({},e))}function m(e){return(0,i.jsx)(c,l({},e))}},59379:function(e,t,r){r.d(t,{f:function(){return d},Z:function(){return p}});var n=r(59499),a=r(81719),o=r(85390),s=r(85893);function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var l=(0,a.ZP)(o.Z)({backgroundColor:"#535047",border:"1px solid rgba(235, 235, 237, 0.12)",padding:"4px"}),c=(0,a.ZP)(o.Z)((function(e){return{backgroundColor:e.theme.palette.background.header,padding:"2px",height:"36px",width:"100%"}}));function d(e){return(0,s.jsx)(c,u({},e))}function p(e){return(0,s.jsx)(l,u({},e))}},81811:function(e,t,r){r.r(t),r.d(t,{RepayModal:function(){return xe}});var n=r(59499),a=r(49501),o=r(23286),s=r(67294),i=r(34220),u=r(8195),l=r(46930),c=r(69125),d=r(48351),p=r(31959),m=r(94635),y=r(75331),b=r(1279),f=r(52358),v=r(61953),x=r(81645),h=r(29630),g=r(70794),A=r(25935),O=r(50029),S=r(87794),j=r.n(S),w=r(74119),T=r(77537),P=r(20301),k=r(68448),D=r(53601),C=r(93608),R=r(20644),E=r(94671),B=r(99730),L=r(17674),Z=r(4730),N=r(80854),I=r(21732),W=r(8656),U=r(67489),F=r(85893),M=["repayAmount","poolReserve","fromAssetData","isWrongNetwork","sx","symbol","rateMode","repayAllDebt","useFlashLoan","blocked","loading","repayWithAmount","buildTxFn"];function _(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Y(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var H=function(e){var t,r=e.repayAmount,n=e.poolReserve,o=e.fromAssetData,s=e.isWrongNetwork,i=e.sx,u=e.symbol,l=e.rateMode,c=e.repayAllDebt,d=e.useFlashLoan,p=e.blocked,m=e.loading,b=e.repayWithAmount,f=e.buildTxFn,v=(0,Z.Z)(e,M),x=(0,W.Yh)((function(e){return[e.paraswapRepayWithCollateral,e.currentMarketData]})),h=(0,L.Z)(x,2),g=h[0],A=h[1],S=(0,I.P)({protocolAction:y.UQ.repayCollateral,handleGetTxns:function(){var e=(0,O.Z)(j().mark((function e(t,r){var a;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f();case 2:return a=e.sent,e.abrupt("return",g({repayAllDebt:c,repayAmount:a.outputAmount,rateMode:l,repayWithAmount:a.inputAmount,fromAssetData:o,poolReserve:n,isWrongNetwork:s,symbol:u,useFlashLoan:d,blocked:p,swapCallData:a.swapCallData,augustus:a.augustus,signature:t,deadline:r,signedAmount:(0,w.sm)(b,o.decimals)}));case 4:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}(),handleGetApprovalTxns:function(){var e=(0,O.Z)(j().mark((function e(){return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",g({repayAllDebt:c,repayAmount:r,rateMode:l,repayWithAmount:b,fromAssetData:o,poolReserve:n,isWrongNetwork:s,symbol:u,useFlashLoan:!1,blocked:p,swapCallData:"0x",augustus:N.hP}));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),gasLimitRecommendation:N.eB[y.UQ.repayCollateral].limit,skip:m||!r||0===parseFloat(r)||p,spender:null!==(t=A.addresses.REPAY_WITH_COLLATERAL_ADAPTER)&&void 0!==t?t:"",deps:[o.symbol,b]}),T=S.approval,P=S.action,k=S.loadingTxns,D=S.approvalTxState,C=S.mainTxState,R=S.requiresApproval;return(0,F.jsx)(U.B,Y(Y({preparingTransactions:k,mainTxState:C,approvalTxState:D,requiresAmount:!0,amount:r,requiresApproval:R,isWrongNetwork:s,sx:i},v),{},{handleAction:P,handleApproval:function(){return T({amount:(0,w.sm)(b,o.decimals),underlyingAsset:o.aTokenAddress})},actionText:(0,F.jsx)(a.cC,{id:"Repay {symbol}",values:{symbol:u}}),actionInProgressText:(0,F.jsx)(a.cC,{id:"Repaying {symbol}",values:{symbol:u}}),fetchingData:m,errorParams:{loading:!1,disabled:p,content:(0,F.jsx)(a.cC,{id:"Repay {symbol}",values:{symbol:u}}),handleClick:P},tryPermit:!0}))};function q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function V(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?q(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):q(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function G(e){var t=e.poolReserve,r=e.symbol,n=e.debtType,o=e.userReserve,c=e.isWrongNetwork,d=(0,i.HT)(),p=d.user,m=d.reserves,S=d.userReserves,L=(0,u.vR)(),Z=L.gasLimit,N=L.txError,I=L.mainTxState,W=(0,l.f)(),U=W.currentChainId,M=W.currentNetworkConfig,_=(0,T.Z)().currentAccount,Y=p.userReservesData.filter((function(e){return"0"!==e.underlyingBalance&&e.underlyingAsset!==t.underlyingAsset&&"stETH"!==e.reserve.symbol})).map((function(e){return{address:e.underlyingAsset,balance:e.underlyingBalance,balanceUSD:e.underlyingBalanceUSD,symbol:e.reserve.symbol,iconSymbol:e.reserve.iconSymbol}})).sort((function(e,t){return Number(t.balanceUSD)-Number(e.balanceUSD)})),q=(0,s.useState)(Y[0]),G=q[0],Q=q[1],z=G.balance||"0",K=(0,s.useState)("exactOut"),J=K[0],X=K[1],$=(0,s.useState)(""),ee=$[0],te=$[1],re=(0,s.useState)("0.5"),ne=re[0],ae=re[1],oe=(0,s.useRef)(""),se=m.find((function(e){return e.underlyingAsset===G.address})),ie=n===y.tk.Stable?(null===o||void 0===o?void 0:o.stableBorrows)||"0":(null===o||void 0===o?void 0:o.variableBorrows)||"0",ue=(0,b.hE)(ie).multipliedBy("1.0025"),le="-1"===ee,ce=le?ue.toString():ee,de=(0,b.hE)(ce).multipliedBy(t.priceInUSD).toString(),pe=ue.multipliedBy(t.priceInUSD).multipliedBy(100+Number(ne)).dividedBy(100).dividedBy(se.priceInUSD),me=V(V({},se),{},{amount:z}),ye=V(V({},t),{},{amount:oe.current});"exactIn"===J&&(me.amount=z,ye.amount="0");var be=le&&(0,b.hE)(z).gte(pe),fe=function(e){var t=e.chainId,r=e.max,n=e.maxSlippage,a=e.skip,o=e.swapIn,i=e.swapOut,u=e.userAddress,l=e.swapVariant,c=(0,s.useState)("0"),d=c[0],p=c[1],m=(0,s.useState)("0"),y=m[0],f=m[1],v=(0,s.useState)("0"),x=v[0],h=v[1],g=(0,s.useState)("0"),A=g[0],S=g[1],T=(0,s.useState)(),P=T[0],k=T[1],D=(0,s.useState)(!1),C=D[0],R=D[1],E=(0,s.useState)(""),B=E[0],L=E[1],Z=(0,s.useMemo)((function(){return{underlyingAsset:o.underlyingAsset,decimals:o.decimals,supplyAPY:o.supplyAPY,amount:o.amount,variableBorrowAPY:o.variableBorrowAPY}}),[o.amount,o.decimals,o.supplyAPY,o.underlyingAsset,o.variableBorrowAPY]),N=(0,s.useMemo)((function(){return{underlyingAsset:i.underlyingAsset,decimals:i.decimals,supplyAPY:i.supplyAPY,amount:i.amount,variableBorrowAPY:i.variableBorrowAPY}}),[i.amount,i.decimals,i.supplyAPY,i.underlyingAsset,i.variableBorrowAPY]),I=(0,s.useCallback)((function(){return(0,w.F8)(Z,N,t,u)}),[t,Z,N,u]),W=(0,s.useCallback)((function(){return(0,w.wP)(Z,N,t,u,r)}),[t,r,Z,N,u]);return(0,s.useEffect)((function(){if(!a){var e=function(){var e=(0,O.Z)(j().mark((function e(){var t,r,a,o;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Z.underlyingAsset&&N.underlyingAsset&&("exactIn"!==l||Z.amount&&"0"!==Z.amount&&!isNaN(+Z.amount))&&("exactOut"!==l||N.amount&&"0"!==N.amount&&!isNaN(+N.amount))){e.next=7;break}return p("0"),f("0"),h("0"),S("0"),k(void 0),e.abrupt("return");case 7:if(R(!0),e.prev=8,"exactIn"!==l){e.next=15;break}return e.next=12,I();case 12:t=e.sent,e.next=18;break;case 15:return e.next=17,W();case 17:t=e.sent;case 18:L(""),k(t),"exactIn"===l?(r=new b.rh(t.destAmount).multipliedBy(1-n/100).toFixed(0),p((0,b.Fv)(t.srcAmount,t.srcDecimals)),h((0,b.Fv)(r,t.destDecimals))):(a=new b.rh(t.srcAmount).multipliedBy(1-n/100).toFixed(0),p((0,b.Fv)(a,t.srcDecimals)),h((0,b.Fv)(t.destAmount,t.destDecimals))),f(t.srcUSD),S(t.destUSD),e.next=30;break;case 25:e.prev=25,e.t0=e.catch(8),console.error(e.t0),o=(0,w.aE)(e.t0.message),L(o);case 30:return e.prev=30,R(!1),e.finish(30);case 33:case"end":return e.stop()}}),e,null,[[8,25,30,33]])})));return function(){return e.apply(this,arguments)}}(),t=setTimeout((function(){e()}),400);return function(){clearTimeout(t)}}}),[a,l,Z.underlyingAsset,Z.amount,N.underlyingAsset,N.amount,I,W,n]),{outputAmount:x,outputAmountUSD:A,inputAmount:d,inputAmountUSD:y,loading:C,error:B,buildTxFn:function(){var e=(0,O.Z)(j().mark((function e(){return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(P){e.next=2;break}throw new Error("Route required to build transaction");case 2:if("exactIn"!==l){e.next=6;break}return e.abrupt("return",(0,w.xS)(P,o,i,t,u,n));case 6:return e.abrupt("return",(0,w._n)(P,o,i,t,u,n));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}}({chainId:M.underlyingChainId||U,userAddress:_,swapVariant:J,swapIn:me,swapOut:ye,max:be,skip:I.loading||!1,maxSlippage:Number(ne)}),ve=fe.inputAmountUSD,xe=fe.inputAmount,he=fe.outputAmount,ge=fe.outputAmountUSD,Ae=fe.loading,Oe=fe.error,Se=fe.buildTxFn,je=Ae&&"0"===ve,we=function(e){var t="-1"===e;t&&(0,b.hE)(z).lt(pe)?(oe.current="",te(""),X("exactIn")):(oe.current=t?ue.toString(10):e,te(e),X("exactOut"))},Te=S.find((function(e){return e.underlyingAsset===G.address})),Pe=(0,k.bU)({amountToReceiveAfterSwap:he,amountToSwap:xe,fromAssetData:se,user:p,toAssetData:t,repayWithUserReserve:Te,debt:ie}),ke=Pe.hfAfterSwap,De=Pe.hfEffectOfFromAmount,Ce=(0,E.gK)(p.healthFactor,De.toString())||(null===se||void 0===se?void 0:se.isFrozen),Re=(0,b.hE)(ie).minus(g.Z.min(he,ie)),Ee=Re.multipliedBy(t.priceInUSD),Be=z?(0,b.hE)(z).minus(xe):(0,b.hE)("0"),Le=Be.multipliedBy(se.priceInUSD),Ze="exactIn"===J?he:ce,Ne="exactIn"===J?ge:de,Ie=(0,E.Vc)(p),We=void 0;Ie.length>0&&!Ie.includes(G.symbol)?We=E.NI.ZERO_LTV_WITHDRAW_BLOCKED:(0,b.hE)(z).lt(xe)&&(We=E.NI.NOT_ENOUGH_COLLATERAL_TO_REPAY_WITH);var Ue=function(){switch(We){case E.NI.NOT_ENOUGH_COLLATERAL_TO_REPAY_WITH:return(0,F.jsx)(a.cC,{id:"Not enough collateral to repay this amount of debt with"});case E.NI.ZERO_LTV_WITHDRAW_BLOCKED:return(0,F.jsx)(a.cC,{id:"Assets with zero LTV ({assetsBlockingWithdraw}) must be withdrawn or disabled as collateral to perform this action",values:{assetsBlockingWithdraw:Ie}});default:return null}};return I.success?(0,F.jsx)(C.R,{action:(0,F.jsx)(a.cC,{id:"Repaid"}),amount:he,symbol:t.symbol}):(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(D.W,{value:Ze,onChange:we,usdValue:Ne,symbol:t.symbol,assets:[{address:t.underlyingAsset,symbol:t.symbol,iconSymbol:t.iconSymbol,balance:ie}],isMaxSelected:le,maxValue:ie,inputTitle:(0,F.jsx)(a.cC,{id:"Expected amount to repay"}),balanceText:(0,F.jsx)(a.cC,{id:"Borrow balance"})}),(0,F.jsxs)(v.Z,{sx:{padding:"18px",pt:"14px",display:"flex",justifyContent:"space-between"},children:[(0,F.jsx)(x.Z,{sx:{fontSize:"18px !important"},children:(0,F.jsx)(f.Z,{})}),(0,F.jsx)(A.B,{loading:je,outputAmountUSD:ge,inputAmountUSD:ve})]}),(0,F.jsx)(D.W,{value:"exactOut"===J?xe:z,usdValue:ve,symbol:G.symbol,assets:Y,onSelect:Q,onChange:we,inputTitle:(0,F.jsx)(a.cC,{id:"Collateral to repay with"}),balanceText:(0,F.jsx)(a.cC,{id:"Borrow balance"}),maxValue:z,loading:je,disableInput:!0}),Oe&&!je&&(0,F.jsx)(h.Z,{variant:"helperText",color:"error.main",children:Oe}),void 0!==We&&(0,F.jsx)(h.Z,{variant:"helperText",color:"error.main",children:(0,F.jsx)(Ue,{})}),(0,F.jsxs)(R.m6,{gasLimit:Z,slippageSelector:(0,F.jsx)(P.n,{selectedSlippage:ne,setSlippage:ae}),children:[(0,F.jsx)(R.jz,{visibleHfChange:"exactOut"===J?!!ee:!!xe,healthFactor:null===p||void 0===p?void 0:p.healthFactor,futureHealthFactor:ke.toString(10),loading:je}),(0,F.jsx)(R.XJ,{description:(0,F.jsx)(a.cC,{id:"Borrow balance after repay"}),futureValue:Re.toString(),futureValueUSD:Ee.toString(),symbol:r,tokenIcon:t.iconSymbol,loading:je,hideSymbolSuffix:!0}),(0,F.jsx)(R.XJ,{description:(0,F.jsx)(a.cC,{id:"Collateral balance after repay"}),futureValue:Be.toString(),futureValueUSD:Le.toString(),symbol:G.symbol,tokenIcon:G.iconSymbol,loading:je,hideSymbolSuffix:!0})]}),N&&(0,F.jsx)(B.f,{txError:N}),(0,F.jsx)(H,{poolReserve:t,fromAssetData:se,repayAmount:he,repayWithAmount:xe,repayAllDebt:be,useFlashLoan:Ce,isWrongNetwork:c,symbol:r,rateMode:n,blocked:void 0!==We||""!==Oe,loading:Ae,buildTxFn:Se})]})}var Q=r(84707),z=r(82403),K=r(20854),J=r(67916),X=r(56371),$=r(70267),ee=r(19419),te=r(28744),re=r(93591),ne=r(32113),ae=r(39771),oe=r(31001),se=["amountToRepay","poolReserve","poolAddress","isWrongNetwork","sx","symbol","debtType","repayWithATokens","blocked","maxApproveNeeded"];function ie(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ue(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ie(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ie(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var le,ce=function(e){var t=e.amountToRepay,r=e.poolReserve,n=e.poolAddress,o=e.isWrongNetwork,i=e.sx,l=e.symbol,c=e.debtType,d=e.repayWithATokens,p=e.blocked,m=e.maxApproveNeeded,b=(0,Z.Z)(e,se),f=(0,W.Yh)((function(e){return[e.repay,e.repayWithPermit,e.encodeRepayParams,e.encodeRepayWithPermitParams,e.tryPermit,e.walletApprovalMethodPreference,e.estimateGasLimit,e.addTransaction,e.useOptimizedPath,e.currentMarketData]})),v=(0,L.Z)(f,10),x=v[0],h=v[1],g=v[2],A=v[3],S=v[4],w=v[5],P=v[6],k=v[7],D=v[8],C=v[9],R=(0,T.Z)().sendTx,B=(0,ee.n)(),I=B.refetchGhoData,M=B.refetchIncentiveData,_=B.refetchPoolData,Y=(0,s.useState)(),H=Y[0],q=Y[1],V=(0,u.vR)(),G=V.approvalTxState,Q=V.mainTxState,z=V.loadingTxns,K=V.setMainTxState,J=V.setTxError,ie=V.setGasLimit,le=V.setLoadingTxns,ce=V.setApprovalTxState,de=(0,re.y)(C,n),pe=de.data,me=de.refetch,ye=de.isFetching,be=de.isFetchedAfterMount,fe=S({reserveAddress:n,isWrappedBaseAsset:r.isWrappedBaseAsset}),ve=fe&&w===ne.n.PERMIT;le(ye);var xe=!d&&0!==Number(t)&&(0,E.iv)({approvedAmount:(null===pe||void 0===pe?void 0:pe.amount)||"0",amount:-1===Number(t)?m:t,signedAmount:H?H.amount:"0"});xe&&null!==G&&void 0!==G&&G.success&&ce({});var he=(0,te.M)({usePermit:ve,approvedAmount:pe,requiresApproval:xe,assetAddress:n,symbol:l,decimals:r.decimals,signatureAmount:t,onApprovalTxConfirmed:me,onSignTxCompleted:function(e){return q(e)}}).approval;(0,s.useEffect)((function(){be||d||me()}),[me,be,d]);var ge=function(){var e=(0,O.Z)(j().mark((function e(){var a,o,s,i,u,p,m,b,f;return j().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,K(ue(ue({},Q),{},{loading:!0})),o=y.UQ.default,!ve||!H){e.next=21;break}if(s={amount:"-1"===t?t:(0,X.parseUnits)(t,r.decimals).toString(),reserve:n,interestRateMode:c,signature:H.signature,deadline:H.deadline},!D()){e.next=9;break}return e.next=8,A(s);case 8:i=e.sent;case 9:return o=y.UQ.repayWithPermit,u=h(ue(ue({},s),{},{encodedTxData:i?i[0]:void 0})),e.next=13,P(u);case 13:return u=e.sent,e.next=16,R(u);case 16:return a=e.sent,e.next=19,a.wait(1);case 19:e.next=36;break;case 21:if(p={amountToRepay:"-1"===t?t:(0,X.parseUnits)(t,r.decimals).toString(),poolAddress:n,repayWithATokens:d,debtType:c},!D()){e.next=26;break}return e.next=25,g(p);case 25:m=e.sent;case 26:return o=y.UQ.repay,b=x(ue(ue({},p),{},{encodedTxData:m})),e.next=30,P(b);case 30:return b=e.sent,e.next=33,R(b);case 33:return a=e.sent,e.next=36,a.wait(1);case 36:K({txHash:a.hash,loading:!1,success:!0}),k(a.hash,{action:o,txState:"success",asset:n,amount:t,assetName:l}),$.queryClient.invalidateQueries({queryKey:oe.B.pool}),_&&_(),M&&M(),I&&I(),e.next=49;break;case 44:e.prev=44,e.t0=e.catch(0),f=(0,ae.WG)(e.t0,ae.aD.GAS_ESTIMATION,!1),J(f),K({txHash:void 0,loading:!1});case 49:case"end":return e.stop()}}),e,null,[[0,44]])})));return function(){return e.apply(this,arguments)}}();return(0,s.useEffect)((function(){var e=0;ve?e=Number(N.eB[y.UQ.supplyWithPermit].recommended):(e=Number(N.eB[y.UQ.supply].recommended),xe&&!G.success&&(e+=Number(E.pQ))),ie(e.toString())}),[xe,G,ve,ie]),(0,F.jsx)(U.B,ue(ue({blocked:p,preparingTransactions:z||!pe,symbol:r.symbol,mainTxState:Q,approvalTxState:G,requiresAmount:!0,amount:t,requiresApproval:xe,isWrongNetwork:o,sx:i},b),{},{handleAction:ge,handleApproval:he,actionText:(0,F.jsx)(a.cC,{id:"Repay {symbol}",values:{symbol:l}}),actionInProgressText:(0,F.jsx)(a.cC,{id:"Repaying {symbol}",values:{symbol:l}}),tryPermit:fe}))},de=function(e){var t,r,n,o=e.poolReserve,c=e.userReserve,p=e.symbol,m=e.tokenBalance,f=e.nativeBalance,v=e.isWrongNetwork,x=e.debtType,A=(0,u.vR)(),O=A.gasLimit,S=A.mainTxState,j=A.txError,w=(0,i.HT)(),T=w.marketReferencePriceInUsd,P=w.user,k=(0,l.f)(),E=k.currentChainId,B=k.currentMarketData,Z=k.currentMarket,I=(0,W.Yh)((function(e){return[e.poolComputed.minRemainingBaseTokenBalance,e.displayGho]})),U=(0,L.Z)(I,2),M=U[0],_=U[1],Y=(0,s.useState)({address:o.underlyingAsset,symbol:o.symbol,iconSymbol:o.iconSymbol,balance:m}),H=Y[0],q=Y[1],V=(0,s.useState)([H]),G=V[0],X=V[1],$=(0,s.useState)(""),ee=$[0],te=$[1],re=(0,s.useState)(""),ne=re[0],ae=re[1],oe=(0,s.useRef)(),se=(0,d.Mo)(E),ie=c.underlyingBalance,ue=c.usageAsCollateralEnabledOnUser,le=c.reserve,de=H.address===o.aTokenAddress,pe=x===y.tk.Stable?(null===c||void 0===c?void 0:c.stableBorrows)||"0":(null===c||void 0===c?void 0:c.variableBorrows)||"0",me=new g.Z(pe).multipliedBy(o.formattedPriceInMarketReferenceCurrency).multipliedBy(T).shiftedBy(-z.$3),ye=(0,b.hE)(pe).multipliedBy("1.0025").decimalPlaces(o.decimals,g.Z.ROUND_UP);if(de)r=g.Z.min(ie,pe),n=ie;else{var be=(0,b.hE)(H.balance).minus((null===c||void 0===c?void 0:c.reserve.symbol.toUpperCase())===se.baseAssetSymbol?M:"0");n=be.toString(10),r=g.Z.min(be,pe)}var fe="-1"===ne,ve=fe?r.toString(10):ne;(0,s.useEffect)((function(){var e=[];if(o.symbol===se.wrappedBaseAssetSymbol){var t=(0,b.hE)(f),r=g.Z.max(t,g.Z.min(t,pe));e.push({address:N.hP.toLowerCase(),symbol:se.baseAssetSymbol,balance:r.toString(10)})}var n=g.Z.min((0,b.hE)(m),pe),a=g.Z.max(n,m);if(e.push({address:o.underlyingAsset,symbol:o.symbol,iconSymbol:o.iconSymbol,balance:a.toString(10)}),B.v3&&!_({symbol:o.symbol,currentMarket:Z})){var s=(0,b.hE)(ie),i=g.Z.max(s,g.Z.min(s,pe).toString(10));e.push({address:o.aTokenAddress,symbol:"a".concat(o.symbol),iconSymbol:o.iconSymbol,aToken:!0,balance:i.toString(10)})}X(e),q(e[0])}),[]);var xe=(0,b.hE)(pe).minus(ve||"0").toString(10),he=new g.Z(xe).multipliedBy(o.formattedPriceInMarketReferenceCurrency).multipliedBy(T).shiftedBy(-z.$3),ge=fe&&he.toNumber()>0,Ae=null===P||void 0===P?void 0:P.healthFactor;if(ve){var Oe=(null===P||void 0===P?void 0:P.totalCollateralUSD)||"0";de&&ue&&(Oe=(0,b.hE)((null===P||void 0===P?void 0:P.totalCollateralUSD)||"0").minus((0,b.hE)(le.priceInUSD).multipliedBy(ve)));var Se=(0,b.hE)((null===P||void 0===P?void 0:P.totalBorrowsUSD)||"0").minus((0,b.hE)(le.priceInUSD).multipliedBy(ve)),je=g.Z.max(Se,0),we=(0,K.L1)({collateralBalanceMarketReferenceCurrency:Oe,borrowBalanceMarketReferenceCurrency:je,currentLiquidationThreshold:(null===P||void 0===P?void 0:P.currentLiquidationThreshold)||"0"});Ae=we.isLessThan(0)&&!we.eq(-1)?"0":we.toString(10)}var Te=(0,b.hE)(ve).multipliedBy(le.priceInUSD);return S.success?(0,F.jsx)(C.R,{action:(0,F.jsx)(a.cC,{id:"repaid"}),amount:oe.current,symbol:de?o.symbol:H.symbol}):(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(D.W,{value:ve,onChange:function(e){var t="-1"===e;oe.current=t?r.toString(10):e,ae(e),t&&(de||r.eq(pe))?H.address===N.hP.toLowerCase()||Q.U[E]&&Q.U[E].toLowerCase()===le.underlyingAsset.toLowerCase()?te(ye.toString(10)):te("-1"):te(ye.lt(n)?ye.toString(10):r.toString(10))},usdValue:Te.toString(10),symbol:H.symbol,assets:G,onSelect:q,isMaxSelected:fe,maxValue:r.toString(10),balanceText:(0,F.jsx)(a.cC,{id:"Wallet balance"})}),ge&&(0,F.jsx)(h.Z,{color:"warning.main",variant:"helperText",children:(0,F.jsx)(a.cC,{id:"You don\u2019t have enough funds in your wallet to repay the full amount. If you proceed to repay with your current amount of funds, you will still have a small borrowing position in your dashboard."})}),(0,F.jsxs)(R.m6,{gasLimit:O,children:[(0,F.jsx)(R.XJ,{description:(0,F.jsx)(a.cC,{id:"Remaining debt"}),futureValue:xe,futureValueUSD:he.toString(10),value:pe,valueUSD:me.toString(),symbol:o.iconSymbol===se.wrappedBaseAssetSymbol?se.baseAssetSymbol:o.iconSymbol}),(0,F.jsx)(R.jz,{visibleHfChange:!!ne,healthFactor:null===P||void 0===P?void 0:P.healthFactor,futureHealthFactor:Ae})]}),j&&(0,F.jsx)(J.Q,{txError:j}),(0,F.jsx)(ce,{maxApproveNeeded:ye.toString(),poolReserve:o,amountToRepay:fe?ee:ve,poolAddress:de?o.underlyingAsset:null!==(t=H.address)&&void 0!==t?t:"",isWrongNetwork:v,symbol:p,debtType:x,repayWithATokens:de})]})},pe=r(34637),me=r(59379),ye=r(57609);function be(e){var t,r=e.repayType,n=e.setRepayType,o=(0,l.f)().currentMarketData,s=(0,W.Yh)((function(e){return e.trackEvent}));return null!==(t=o.enabledFeatures)&&void 0!==t&&t.collateralRepay?(0,F.jsxs)(v.Z,{sx:{mb:6},children:[(0,F.jsx)(h.Z,{mb:1,color:"text.secondary",children:(0,F.jsx)(a.cC,{id:"Repay with"})}),(0,F.jsxs)(me.f,{color:"primary",value:r,exclusive:!0,onChange:function(e,t){return n(t)},children:[(0,F.jsx)(pe.Y,{value:le.BALANCE,disabled:r===le.BALANCE,onClick:function(){return s(ye.rQ.SWITCH_REPAY_TYPE,{repayType:"Wallet Balance"})},children:(0,F.jsx)(h.Z,{variant:"buttonM",children:(0,F.jsx)(a.cC,{id:"Wallet balance"})})}),(0,F.jsx)(pe.Y,{value:le.COLLATERAL,disabled:r===le.COLLATERAL,onClick:function(){return s(ye.rQ.SWITCH_REPAY_TYPE,{repayType:"Collateral"})},children:(0,F.jsx)(h.Z,{variant:"buttonM",children:(0,F.jsx)(a.cC,{id:"Collateral"})})})]})]}):null}function fe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ve(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?fe(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fe(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}!function(e){e[e.BALANCE=0]="BALANCE",e[e.COLLATERAL=1]="COLLATERAL"}(le||(le={}));var xe=function(){var e,t=(0,u.vR)(),r=t.type,n=t.close,y=t.args,b=t.mainTxState,f=(0,i.HT)(),v=f.userReserves,x=f.reserves,h=(0,l.f)().currentMarketData,g=(0,s.useState)(le.BALANCE),A=g[0],O=g[1],S=null===(e=x.find((function(e){return"stETH"===e.symbol})))||void 0===e?void 0:e.underlyingAsset,j=(0,c.hN)(x),w=d.cr.collateralRepay(h)&&y.underlyingAsset!==(null===j||void 0===j?void 0:j.underlyingAsset)&&v.some((function(e){return"0"!==e.scaledATokenBalance&&e.underlyingAsset!==y.underlyingAsset&&e.underlyingAsset!==S}));return(0,F.jsx)(p.P,{open:r===u.w8.Repay,setOpen:function(){O(le.BALANCE),n()},children:(0,F.jsx)(m.A,{title:(0,F.jsx)(a.cC,{id:"Repay"}),underlyingAsset:y.underlyingAsset,requiredPermission:o.g.BORROWER,children:function(e){return(0,F.jsxs)(F.Fragment,{children:[w&&!b.txHash&&(0,F.jsx)(be,{repayType:A,setRepayType:O}),A===le.BALANCE&&(0,F.jsx)(de,ve(ve({},e),{},{debtType:y.currentRateMode})),A===le.COLLATERAL&&(0,F.jsx)(G,ve(ve({},e),{},{debtType:y.currentRateMode}))]})}})})}},28744:function(e,t,r){r.d(t,{M:function(){return h}});var n=r(59499),a=r(50029),o=r(17674),s=r(87794),i=r.n(s),u=r(75331),l=r(80854),c=r(21046),d=r(56371),p=r(89291),m=r(77537),y=r(8656),b=r(39771),f=r(8195);function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function x(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach((function(t){(0,n.Z)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var h=function(e){var t=e.usePermit,r=e.approvedAmount,n=e.requiresApproval,s=e.assetAddress,v=e.symbol,h=e.decimals,g=e.signatureAmount,A=e.onApprovalTxConfirmed,O=e.onSignTxCompleted,S=(0,y.Yh)((function(e){return[e.generateApproval,e.generateSignatureRequest,e.estimateGasLimit,e.addTransaction]})),j=(0,o.Z)(S,4),w=j[0],T=j[1],P=j[2],k=j[3],D=(0,m.Z)(),C=D.signTxData,R=D.sendTx,E=(0,f.vR)(),B=E.approvalTxState,L=E.setApprovalTxState,Z=E.setTxError,N=function(){var e=(0,a.Z)(i().mark((function e(){var a,o,m,y,f,S;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!n||!r){e.next=30;break}if(!t){e.next=16;break}return L(x(x({},B),{},{loading:!0})),a=Math.floor(Date.now()/1e3+3600).toString(),e.next=7,T(x(x({},r),{},{deadline:a,amount:"-1"===g?c.Bz.toString():(0,d.parseUnits)(g,h).toString()}));case 7:return o=e.sent,e.next=10,C(o);case 10:m=e.sent,O&&O({signature:m,deadline:a,amount:g}),Z(void 0),L({txHash:p.Z,loading:!1,success:!0}),e.next=30;break;case 16:return y=w(r),L(x(x({},B),{},{loading:!0})),e.next=20,P(y);case 20:return y=e.sent,e.next=23,R(y);case 23:return f=e.sent,e.next=26,f.wait(1);case 26:L({txHash:f.hash,loading:!1,success:!0}),Z(void 0),k(f.hash,{action:u.UQ.approval,txState:"success",asset:s,amount:l.ke,assetName:v}),A&&A();case 30:e.next=37;break;case 32:e.prev=32,e.t0=e.catch(0),S=(0,b.WG)(e.t0,b.aD.GAS_ESTIMATION,!1),Z(S),L({txHash:void 0,loading:!1});case 37:case"end":return e.stop()}}),e,null,[[0,32]])})));return function(){return e.apply(this,arguments)}}();return{approval:N}}},93591:function(e,t,r){r.d(t,{y:function(){return i}});var n=r(36492),a=r(8656),o=r(31001),s=r(12987),i=function(e,t){var r=(0,s.z)().approvedAmountService,i=(0,a.Yh)((function(e){return e.account}));return(0,n.a)({queryFn:function(){return r.getPoolApprovedAmount(e,i,t)},queryKey:o.B.poolApprovedAmount(i,t,e),enabled:!!i,refetchOnMount:!1,refetchOnWindowFocus:!1,refetchOnReconnect:!1})}}}]);